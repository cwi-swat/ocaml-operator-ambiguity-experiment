(
  type
  (
    peg
      type
        params =
          (
          )
        cstrs =
          (
          )
        kind =
            (
              Out
                (
                )
                              Empty
                (
                )
                              Peg
                (
                )
                            )
            )
  let
  (
    board
      array
      (
        array
        (
          Out
                    Out
                    Out
                    Out
                    Out
                    Out
                    Out
                    Out
                    Out
                  )
        array
        (
          Out
                    Out
                    Out
                    Peg
                    Peg
                    Peg
                    Out
                    Out
                    Out
                  )
        array
        (
          Out
                    Out
                    Out
                    Peg
                    Peg
                    Peg
                    Out
                    Out
                    Out
                  )
        array
        (
          Out
                    Peg
                    Peg
                    Peg
                    Peg
                    Peg
                    Peg
                    Peg
                    Out
                  )
        array
        (
          Out
                    Peg
                    Peg
                    Peg
                    Empty
                    Peg
                    Peg
                    Peg
                    Out
                  )
        array
        (
          Out
                    Peg
                    Peg
                    Peg
                    Peg
                    Peg
                    Peg
                    Peg
                    Out
                  )
        array
        (
          Out
                    Out
                    Out
                    Peg
                    Peg
                    Peg
                    Out
                    Out
                    Out
                  )
        array
        (
          Out
                    Out
                    Out
                    Peg
                    Peg
                    Peg
                    Out
                    Out
                    Out
                  )
        array
        (
          Out
                    Out
                    Out
                    Out
                    Out
                    Out
                    Out
                    Out
                    Out
                  )
      )
  )
  let
  (
    print_peg
      (
        case
        (
          Out
                    print_string
          (
            
              "."
          )
        )
        case
        (
          Empty
                    print_string
          (
            
              " "
          )
        )
        case
        (
          Peg
                    print_string
          (
            
              "$"
          )
        )
      )
  )
  let
  (
    print_board
      (
        case
        (
          board
          for i
          0
          8
          sequence
          (
            for j
            0
            8
            print_peg
            (
              
                Array.get
                (
                  
                    Array.get
                    (
                      
                        board
                      
                        i
                    )
                  
                    j
                )
            )
          ;
            print_newline
            (
              
                ()
                            )
          )
        )
      )
  )
  type
  (
    direction
      type
        params =
          (
          )
        cstrs =
          (
          )
        kind =
            (
              dx
                  poly
                  
                     int
                    (
                    )
              dy
                  poly
                  
                     int
                    (
                    )
            )
            )
  let
  (
    dir
      array
      (
        record
        (
          dx
            0
          dy
            1
        )
                record
        (
          dx
            1
          dy
            0
        )
                record
        (
          dx
            0
          dy
            -1
        )
                record
        (
          dx
            -1
          dy
            0
        )
              )
  )
  type
  (
    move
      type
        params =
          (
          )
        cstrs =
          (
          )
        kind =
            (
              x1
                  poly
                  
                     int
                    (
                    )
              y1
                  poly
                  
                     int
                    (
                    )
              x2
                  poly
                  
                     int
                    (
                    )
              y2
                  poly
                  
                     int
                    (
                    )
            )
            )
  let
  (
    moves
      Array.create
      (
        
          31
        
          record
          (
            x1
              0
            y1
              0
            x2
              0
            y2
              0
          )
                )
  )
  let
  (
    counter
      ref
      (
        
          0
      )
  )
  exception Found
  (
  )
  let
  (
    solve
      (
        case
        (
          m
          sequence
          (
            :=
            (
              
                counter
              
                +
                (
                  
                    !
                    (
                      
                        counter
                    )
                  
                    1
                )
            )
          ;
            ifthenelse
            (
              if
              (
                =
                (
                  
                    m
                  
                    31
                )
              )
              then
              (
                match
                Array.get
                (
                  
                    Array.get
                    (
                      
                        board
                      
                        4
                    )
                  
                    4
                )
                (
                  case
                  (
                    Peg
                                        true
                                      )
                  case
                  (
                    _
                    false
                                      )
                )
              )
              else
              (
                  try
                  sequence
                  (
                    ifthenelse
                    (
                      if
                      (
                        =
                        (
                          
                            mod
                            (
                              
                                !
                                (
                                  
                                    counter
                                )
                              
                                500
                            )
                          
                            0
                        )
                      )
                      then
                      (
                        sequence
                        (
                          print_int
                          (
                            
                              !
                              (
                                
                                  counter
                              )
                          )
                        ;
                          print_newline
                          (
                            
                              ()
                                                        )
                        )
                      )
                      else
                      (
                                              )
                    )
                  ;
                    sequence
                    (
                      for i
                      1
                      7
                      for j
                      1
                      7
                      match
                      Array.get
                      (
                        
                          Array.get
                          (
                            
                              board
                            
                              i
                          )
                        
                          j
                      )
                      (
                        case
                        (
                          Peg
                                                    for k
                          0
                          3
                          let
                          (
                            (
                              d1
                                field
                                (
                                Array.get
                                (
                                  
                                    dir
                                  
                                    k
                                )
                                dx
                                )
                            )
                          in
                            let
                            (
                              (
                                d2
                                  field
                                  (
                                  Array.get
                                  (
                                    
                                      dir
                                    
                                      k
                                  )
                                  dy
                                  )
                              )
                            in
                              let
                              (
                                (
                                  i1
                                    +
                                    (
                                      
                                        i
                                      
                                        d1
                                    )
                                )
                              in
                                let
                                (
                                  (
                                    i2
                                      +
                                      (
                                        
                                          i1
                                        
                                          d1
                                      )
                                  )
                                in
                                  let
                                  (
                                    (
                                      j1
                                        +
                                        (
                                          
                                            j
                                          
                                            d2
                                        )
                                    )
                                  in
                                    let
                                    (
                                      (
                                        j2
                                          +
                                          (
                                            
                                              j1
                                            
                                              d2
                                          )
                                      )
                                    in
                                      match
                                      Array.get
                                      (
                                        
                                          Array.get
                                          (
                                            
                                              board
                                            
                                              i1
                                          )
                                        
                                          j1
                                      )
                                      (
                                        case
                                        (
                                          Peg
                                                                                    match
                                          Array.get
                                          (
                                            
                                              Array.get
                                              (
                                                
                                                  board
                                                
                                                  i2
                                              )
                                            
                                              j2
                                          )
                                          (
                                            case
                                            (
                                              Empty
                                                                                            sequence
                                              (
                                                Array.set
                                                (
                                                  
                                                    Array.get
                                                    (
                                                      
                                                        board
                                                      
                                                        i
                                                    )
                                                  
                                                    j
                                                  
                                                    Empty
                                                                                                    )
                                              ;
                                                sequence
                                                (
                                                  Array.set
                                                  (
                                                    
                                                      Array.get
                                                      (
                                                        
                                                          board
                                                        
                                                          i1
                                                      )
                                                    
                                                      j1
                                                    
                                                      Empty
                                                                                                        )
                                                ;
                                                  sequence
                                                  (
                                                    Array.set
                                                    (
                                                      
                                                        Array.get
                                                        (
                                                          
                                                            board
                                                          
                                                            i2
                                                        )
                                                      
                                                        j2
                                                      
                                                        Peg
                                                                                                            )
                                                  ;
                                                    sequence
                                                    (
                                                      ifthenelse
                                                      (
                                                        if
                                                        (
                                                          solve
                                                          (
                                                            
                                                              +
                                                              (
                                                                
                                                                  m
                                                                
                                                                  1
                                                              )
                                                          )
                                                        )
                                                        then
                                                        (
                                                          sequence
                                                          (
                                                            Array.set
                                                            (
                                                              
                                                                moves
                                                              
                                                                m
                                                              
                                                                record
                                                                (
                                                                  x1
                                                                    i
                                                                  y1
                                                                    j
                                                                  x2
                                                                    i2
                                                                  y2
                                                                    j2
                                                                )
                                                                                                                            )
                                                          ;
                                                            raise
                                                            (
                                                              
                                                                Found
                                                                                                                            )
                                                          )
                                                        )
                                                        else
                                                        (
                                                                                                                  )
                                                      )
                                                    ;
                                                      sequence
                                                      (
                                                        Array.set
                                                        (
                                                          
                                                            Array.get
                                                            (
                                                              
                                                                board
                                                              
                                                                i
                                                            )
                                                          
                                                            j
                                                          
                                                            Peg
                                                                                                                    )
                                                      ;
                                                        sequence
                                                        (
                                                          Array.set
                                                          (
                                                            
                                                              Array.get
                                                              (
                                                                
                                                                  board
                                                                
                                                                  i1
                                                              )
                                                            
                                                              j1
                                                            
                                                              Peg
                                                                                                                        )
                                                        ;
                                                          Array.set
                                                          (
                                                            
                                                              Array.get
                                                              (
                                                                
                                                                  board
                                                                
                                                                  i2
                                                              )
                                                            
                                                              j2
                                                            
                                                              Empty
                                                                                                                        )
                                                        )
                                                      )
                                                    )
                                                  )
                                                )
                                              )
                                            )
                                            case
                                            (
                                              _
                                              ()
                                                                                          )
                                          )
                                        )
                                        case
                                        (
                                          _
                                          ()
                                                                                  )
                                      )
                                    )
                                  )
                                )
                              )
                            )
                          )
                        )
                        case
                        (
                          _
                          ()
                                                  )
                      )
                    ;
                      false
                                          )
                  )
                  (
                    case
                    (
                      Found
                                            true
                                          )
                  )
              )
            )
          )
        )
      )
  )
  ifthenelse
  (
    if
    (
      solve
      (
        
          0
      )
    )
    then
    (
      sequence
      (
        print_string
        (
          
            "\n"
        )
      ;
        print_board
        (
          
            board
        )
      )
    )
    else
    (
          )
  )
)

