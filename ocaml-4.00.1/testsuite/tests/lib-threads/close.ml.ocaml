(
  let
  (
    main
      (
        case
        (
          ()
                    let
          (
            (
              (
                rd
                wr
              )
                Unix.pipe
                (
                  
                    ()
                                    )
            )
          in
            let
            (
              (
                _
                  Thread.create
                  (
                    
                      (
                        case
                        (
                          ()
                                                    sequence
                          (
                            ignore
                            (
                              
                                Unix.write
                                (
                                  
                                    wr
                                  
                                    "0123456789"
                                  
                                    0
                                  
                                    10
                                )
                            )
                          ;
                            sequence
                            (
                              Thread.delay
                              (
                                
                                  3.0
                              )
                            ;
                              sequence
                              (
                                print_endline
                                (
                                  
                                    "closing fd..."
                                )
                              ;
                                Unix.close
                                (
                                  
                                    rd
                                )
                              )
                            )
                          )
                        )
                      )
                    
                      ()
                                        )
              )
            in
              let
              (
                (
                  buf
                    String.create
                    (
                      
                        10
                    )
                )
              in
                sequence
                (
                  print_endline
                  (
                    
                      "reading..."
                  )
                ;
                  sequence
                  (
                    ignore
                    (
                      
                        Unix.read
                        (
                          
                            rd
                          
                            buf
                          
                            0
                          
                            10
                        )
                    )
                  ;
                    print_endline
                    (
                      
                        "read returned"
                    )
                  )
                )
              )
            )
          )
        )
      )
  )
  Unix.handle_unix_error
  (
    
      main
    
      ()
        )
)

